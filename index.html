<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.449">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kyle Onda, Center for Geospatial Solutions">
<meta name="dcterms.date" content="2022-06-29">

<title>A Federal Use Case of the National Water Service Boundary Layer: Screening communities for drinking water finance for the Justice40 Initiative.</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link class="quarto-color-scheme" id="quarto-text-highlighting-styles" href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
<link class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles" href="index_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link class="quarto-color-scheme" href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<link class="quarto-color-scheme quarto-color-alternate" href="index_files/libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet">
<script src="index_files/libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="index_files/libs/jquery-1.12.4/jquery.min.js"></script>
<link href="index_files/libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="index_files/libs/leaflet-1.3.1/leaflet.js"></script>
<link href="index_files/libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="index_files/libs/proj4-2.6.2/proj4.min.js"></script>
<script src="index_files/libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="index_files/libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="index_files/libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="index_files/libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="index_files/libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>
<script src="index_files/libs/FlatGeoBuf-3.3.3/fgb.js"></script>
<script src="index_files/libs/FlatGeoBuf-3.3.3/flatgeobuf-geojson.min.js"></script>
<script src="index_files/libs/chromajs-2.1.0/chroma.min.js"></script>
<link id="TractCategory-1-attachment" rel="attachment" href="index_files/libs/TractCategory-0.0.1/TractCategory_layer.fgb">
<link href="index_files/libs/HomeButton-0.0.1/home-button.css" rel="stylesheet">
<script src="index_files/libs/HomeButton-0.0.1/home-button.js"></script>
<script src="index_files/libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="index_files/libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="index_files/libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="index_files/libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">


<link rel="stylesheet" href="styles.css">
</head>

<body>

<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">A Federal Use Case of the National Water Service Boundary Layer: Screening communities for drinking water finance for the Justice40 Initiative.</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Kyle Onda, Center for Geospatial Solutions </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 29, 2022</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"> <span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#defining-a-drinking-water-environmental-justice-indicator" id="toc-defining-a-drinking-water-environmental-justice-indicator" class="nav-link" data-scroll-target="#defining-a-drinking-water-environmental-justice-indicator"> <span class="header-section-number">2</span> Defining a drinking water environmental justice indicator</a>
  <ul class="collapse">
  <li><a href="#terminology" id="toc-terminology" class="nav-link" data-scroll-target="#terminology"> <span class="header-section-number">2.1</span> Terminology</a></li>
  <li><a href="#review-of-metrics" id="toc-review-of-metrics" class="nav-link" data-scroll-target="#review-of-metrics"> <span class="header-section-number">2.2</span> Review of metrics</a></li>
  <li><a href="#proposed-metric" id="toc-proposed-metric" class="nav-link" data-scroll-target="#proposed-metric"> <span class="header-section-number">2.3</span> Proposed metric</a></li>
  </ul></li>
  <li><a href="#implementing-the-metric" id="toc-implementing-the-metric" class="nav-link" data-scroll-target="#implementing-the-metric"> <span class="header-section-number">3</span> Implementing the metric</a>
  <ul class="collapse">
  <li><a href="#collate-health-based-violations-with-compliance-periods-ending-march-2020-or-later-from-sdwis" id="toc-collate-health-based-violations-with-compliance-periods-ending-march-2020-or-later-from-sdwis" class="nav-link" data-scroll-target="#collate-health-based-violations-with-compliance-periods-ending-march-2020-or-later-from-sdwis"> <span class="header-section-number">3.1</span> Collate health-based violations with compliance periods ending March 2020 or later from SDWIS</a></li>
  <li><a href="#calculate-the-number-of-days-in-health-based-violation-by-each-cws-within-this-period" id="toc-calculate-the-number-of-days-in-health-based-violation-by-each-cws-within-this-period" class="nav-link" data-scroll-target="#calculate-the-number-of-days-in-health-based-violation-by-each-cws-within-this-period"> <span class="header-section-number">3.2</span> Calculate the number of days in health-based violation by each CWS within this period</a></li>
  <li><a href="#filter-to-cws-with-greater-than-30-such-days" id="toc-filter-to-cws-with-greater-than-30-such-days" class="nav-link" data-scroll-target="#filter-to-cws-with-greater-than-30-such-days"> <span class="header-section-number">3.3</span> Filter to CWS with greater than 30 such days</a></li>
  <li><a href="#filter-the-temm-national-water-service-boundary-layer-to-those-states-with-comprehensive-non-county-based-tier-1-boundaries-plus-utah" id="toc-filter-the-temm-national-water-service-boundary-layer-to-those-states-with-comprehensive-non-county-based-tier-1-boundaries-plus-utah" class="nav-link" data-scroll-target="#filter-the-temm-national-water-service-boundary-layer-to-those-states-with-comprehensive-non-county-based-tier-1-boundaries-plus-utah"> <span class="header-section-number">3.4</span> Filter the TEMM national water service boundary layer to those states with comprehensive, non-county-based Tier 1 boundaries, plus Utah</a></li>
  <li><a href="#filter-the-cejst-census-tracts-to-the-same-states" id="toc-filter-the-cejst-census-tracts-to-the-same-states" class="nav-link" data-scroll-target="#filter-the-cejst-census-tracts-to-the-same-states"> <span class="header-section-number">3.5</span> Filter the CEJST Census Tracts to the same states</a></li>
  <li><a href="#filter-to-the-resulting-set-of-cws-with-violations" id="toc-filter-to-the-resulting-set-of-cws-with-violations" class="nav-link" data-scroll-target="#filter-to-the-resulting-set-of-cws-with-violations"> <span class="header-section-number">3.6</span> Filter to the resulting set of CWS with violations</a></li>
  <li><a href="#assign-the-indicator-to-cejst-census-tracts-that-spatially-intersect-this-set-of-cws" id="toc-assign-the-indicator-to-cejst-census-tracts-that-spatially-intersect-this-set-of-cws" class="nav-link" data-scroll-target="#assign-the-indicator-to-cejst-census-tracts-that-spatially-intersect-this-set-of-cws"> <span class="header-section-number">3.7</span> Assign the indicator to CEJST Census Tracts that spatially intersect this set of CWS</a></li>
  <li><a href="#calculate-and-compare-summary-statistics-for-the-original-set-of-cejst-tracts-in-the-filtered-states-and-the-new-set-by-state-including" id="toc-calculate-and-compare-summary-statistics-for-the-original-set-of-cejst-tracts-in-the-filtered-states-and-the-new-set-by-state-including" class="nav-link" data-scroll-target="#calculate-and-compare-summary-statistics-for-the-original-set-of-cejst-tracts-in-the-filtered-states-and-the-new-set-by-state-including"> <span class="header-section-number">3.8</span> Calculate and compare summary statistics for the original set of CEJST tracts (in the filtered states) and the new set, by state, including:</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion"> <span class="header-section-number">4</span> Discussion</a>
  <ul class="collapse">
  <li><a href="#headline-1" id="toc-headline-1" class="nav-link" data-scroll-target="#headline-1"> <span class="header-section-number">4.1</span> Headline 1:</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">




<!-- # Initialization -->
<!-- We require the following packages: -->
<!-- ```{r} -->
<!-- #| echo: false -->
<!-- #| include: false -->
<!-- library(tidyverse) -->
<!-- library(sf) -->
<!-- library(mapview) -->
<!-- library(qs) -->
<!-- ``` -->
<!-- ## Download SDWIS Violations Data -->
<!-- Here we download all of the SDWIS data, and save to a compressed local file -->
<!-- ```{r} -->
<!-- #| eval: false -->
<!-- download.file(url = "https://echo.epa.gov/files/echodownloads/SDWA_latest_downloads.zip", -->
<!--               destfile = "../data/sdwa.zip") -->
<!-- unzip("../data/sdwa.zip", exdir="../data/sdwa") -->
<!-- x <- readr::read_csv("../data/sdwa/SDWA_VIOLATIONS_ENFORCEMENT.csv") -->
<!-- qsave(x,"../data/viol.qs") -->
<!-- ``` -->
<!-- ## Download TEMM Data -->
<!-- Here we download the service boundaries layer, saving to a local compressed file -->
<!-- ```{r} -->
<!-- #| eval: false -->
<!-- temm <- sf::read_sf("https://www.hydroshare.org/resource/6f3386bb4bc945028391cfabf1ea252e/data/contents/temm_layer_v1.0.0/temm.geojson") -->
<!-- qsave(temm, "../data/temm.qs") -->
<!-- ``` -->
<!-- ## Load compressed data -->
<!-- Here we load the compressed data -->
<!-- ```{r} -->
<!-- v <- qread("../data/viol.qs") -->
<!-- g <- qread("../data/temm.qs") -->
<!-- ``` -->
<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>The purpose of this exercise is to demonstrate the value of the <a href="https://www.policyinnovation.org/blog/water-boundaries-data">National Water Service Area Boundary layer</a> with a Federal government use case. This use case is to quantify the extent to which adding a drinking water quality-based indicator to the Climate and Environmental Justice Screening Tool would change the universe of “communities” (2010 Census Tract geographies) that are highlighted. This document describes the how to construct a binary indicator that corresponds to some drinking-water related risk, implements the indicator</p>
</section>
<section id="defining-a-drinking-water-environmental-justice-indicator" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="defining-a-drinking-water-environmental-justice-indicator"><span class="header-section-number">2</span> Defining a drinking water environmental justice indicator</h2>
<p>The most common way to do this is to calculate an indicator variable based on drinking water violations data from the U.S. EPA SDWIS database. Here, I review and go over the pros and cons of the most common approaches in governance and the literature. First, some necessary terminology:</p>
<section id="terminology" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="terminology"><span class="header-section-number">2.1</span> Terminology</h3>
<dl>
<dt>Violation</dt>
<dd>
<p>A violation of regulations of the Safe Drinking Water Act</p>
</dd>
<dt>Maximum Contaminant Level (MCL) Violation</dt>
<dd>
<p>When a concentration of a contaminant is detected to be above the limit allowed in drinking water standards.</p>
</dd>
<dt>Total Coliform Rule</dt>
<dd>
<p>A group of maximum contaminant levels and monitoring requirements for the presence of total coliform, fecal coliform, and <em>E. coli</em> bacteria.</p>
</dd>
<dt>Maximum Residual Disinfectant Level (MRDL) Violations</dt>
<dd>
<p>When a concentration of a disinfectant residual is detected to be above the limit allowed in drinking water standards.</p>
</dd>
<dt>Treatment Technique (TT) rule Violations</dt>
<dd>
<p>When specified treatment techniques required for a system’s water source are not applied.</p>
</dd>
<dt>Health-based violations</dt>
<dd>
<p>Violations that are directly related to health risks in drinking water. Corresponds to all MCL, MRDL, and TT violations.</p>
</dd>
<dt>Monitoring and reporting (MR) violations</dt>
<dd>
<p>Failure to conduct drinking water quality tests or to submit the results of those tests in a timely fashion to USEPA or the primacy agency.</p>
</dd>
<dt>Other Violations</dt>
<dd>
<p>A USEPA catch-all category for other violations, which are generally either about conducting sanitary surveys of the system or about reporting their test results to the public or water systems they are interconnected with.</p>
</dd>
<dt>Compliance</dt>
<dd>
<p>Being in a state of not violating a relevant regulation</p>
</dd>
<dt>Compliance period</dt>
<dd>
<p>A period of time when a water system was in violation of a drinking water regulation</p>
</dd>
</dl>
</section>
<section id="review-of-metrics" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="review-of-metrics"><span class="header-section-number">2.2</span> Review of metrics</h3>
<p>There are a few considerations in constructing a binary violation indicator:</p>
<ol type="1">
<li>What types of violations count? MCL only? Health-based only? All?</li>
<li>What contaminants should count in the case of MCL violations? Those monitored under the Total Coliform Rule? Lead and Copper Rule? Nitrates? All?</li>
<li>How long does a violation need to last to be counted? 0 time? 1 month? 1 year?</li>
<li>Over what time period do they count? The past year? 2 years? 5 years? Forever?</li>
</ol>
<p>A brief review of the literature follows.</p>
<table class="table">
<thead>
<tr class="header">
<th>Description of metric</th>
<th>Pros</th>
<th>Cons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>EPA “Enforcement Priority” (formerly “Serious Violator”), a threshold composed of points weighted highest towards TCR violations, less so for other health-based violations like Nitrates andl LCR, and least for repeated reporting violations over a rolling 5-year period. <a href="https://www.epa.gov/sites/default/files/documents/drinking_water_erp_2009.pdf">See here</a>. Does not count violations that are returned to compliance or are undergoing a verified enforcement action.</td>
<td><ul>
<li><p>Already used by USEPA to prioritize enforcement efforts, legitimating use in CEJST</p></li>
<li><p>Weighs violations on certain contaminants more highly based on relative risks to health</p></li>
<li><p>Includes monitoring violations in a scaled manner, focusing on repeat violations.</p></li>
<li><p>Cares about the speed of return to compliance, i.e.&nbsp;some measure of the temporal aspect of a health risk exposure</p></li>
</ul></td>
<td><ul>
<li><p>May be considered stigmatizing by utility community</p></li>
<li><p>Opaque, masks the difference between contaminant exposures and negligent monitoring or reporting</p></li>
<li><p>Includes non-health based violations that may not be desirable in a “access to safe water” oriented indicator</p></li>
<li><p>Not including violations with enforcement actions may underestimate current health risks to the service population</p></li>
</ul></td>
</tr>
<tr class="even">
<td>All violations, over a multi-year period <span class="citation" data-cites="wallsten2008 konisky2015 marcillo2019">(<a href="#ref-wallsten2008" role="doc-biblioref">Wallsten and Kosec 2008</a>; <a href="#ref-konisky2015" role="doc-biblioref">Konisky and Teodoro 2015</a>; <a href="#ref-marcillo2019" role="doc-biblioref">Marcillo and Krometis 2019</a>)</span></td>
<td><ul>
<li>Simple to calculate</li>
<li>Including monitoring violations captures governance and capacity problems that can undermine the ability of water systems to respond to the needs of their customers.</li>
</ul></td>
<td><ul>
<li>Including monitoring violations may not be appropriate to a health/exposure-based metric</li>
</ul></td>
</tr>
<tr class="odd">
<td>TCR MCL violations only, on an annual basis <span class="citation" data-cites="allaire2018">(<a href="#ref-allaire2018" role="doc-biblioref">Allaire, Wu, and Lall 2018</a>)</span></td>
<td><ul>
<li>There is some <a href="https://nepis.epa.gov/Exe/ZyPURL.cgi?Dockey=P100529K.TXT">evidence</a> that TCR violations are the most systematically reported. Other violations may give a biased estimate.</li>
</ul></td>
<td><ul>
<li><p>Does not count the many documented cases of other kinds of violations</p></li>
<li><p>The “bias” evidence is from 2000 and may not be as relevant today</p></li>
</ul></td>
</tr>
<tr class="even">
<td>All MCL violations over a multi-year period <span class="citation" data-cites="dobbin2021 switzer2017">(<a href="#ref-dobbin2021" role="doc-biblioref">Dobbin and Fencl 2021</a>; <a href="#ref-switzer2017" role="doc-biblioref">Switzer and Teodoro 2017</a>)</span></td>
<td><ul>
<li>Intuitive appeal for considering all contaminants a potential health risk exposure</li>
</ul></td>
<td><ul>
<li><p>MRDLs and treatment failures are also important health risk exposures</p></li>
<li><p>Does not capture institutional risks associated with monitoring/ reporting violations</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>All Health-Based Violations over a multi-year period <span class="citation" data-cites="dobbin2021 switzer2017">(<a href="#ref-dobbin2021" role="doc-biblioref">Dobbin and Fencl 2021</a>; <a href="#ref-switzer2017" role="doc-biblioref">Switzer and Teodoro 2017</a>)</span></td>
<td><ul>
<li>Intuitive appeal for considering all health-based violations</li>
</ul></td>
<td><ul>
<li>Does not capture institutional risks associated with monitoring/ reporting violations</li>
</ul></td>
</tr>
</tbody>
</table>
</section>
<section id="proposed-metric" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="proposed-metric"><span class="header-section-number">2.3</span> Proposed metric</h3>
<p>Binary indicator, which is if the system experienced more than 1 month in health-based violation in the past two years. Discussion can modify the month and year periods. I believe giving a grace period for 1 month over two years leaves room for true fluke events for utilities that otherwise have good process control. I can also simply create the metric for a few combinations and we can see what seems reasonable.</p>
</section>
</section>
<section id="implementing-the-metric" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="implementing-the-metric"><span class="header-section-number">3</span> Implementing the metric</h2>
<p>First, we load required packages</p>
<div class="cell">
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapview)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vroom)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(qs)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sf_use_s2</span>(<span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Below, we describe and implement the workflow in R.</p>
<section id="collate-health-based-violations-with-compliance-periods-ending-march-2020-or-later-from-sdwis" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="collate-health-based-violations-with-compliance-periods-ending-march-2020-or-later-from-sdwis"><span class="header-section-number">3.1</span> Collate health-based violations with compliance periods ending March 2020 or later from SDWIS</h3>
<p>First, we retrieve the .zip archive of the SDWIS data download from USEPA, and unzip the violations data table.</p>
<div class="cell">
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">"https://echo.epa.gov/files/echodownloads/SDWA_latest_downloads.zip"</span>, <span class="at">destfile =</span> <span class="st">"../data/sdwa.zip"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">"data/sdwa.zip"</span>, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">files =</span> <span class="st">"SDWA_VIOLATIONS_ENFORCEMENT.csv"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">exdir =</span> <span class="st">"data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This archive has several tables, the relevant one being <code>SDWA_VIOLATIONS_ENFORCEMENT.csv</code>, which as of this version of the workflow, was last updated on April 13, 2022.</p>
<div class="cell">
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">"data/sdwa.zip"</span>, <span class="at">list =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                              Name     Length                Date
1       SDWA_EVENTS_MILESTONES.csv   36426509 2022-04-13 15:11:00
2              SDWA_FACILITIES.csv  156229271 2022-04-13 15:13:00
3        SDWA_GEOGRAPHIC_AREAS.csv   40040738 2022-04-13 15:13:00
4             SDWA_LCR_SAMPLES.csv  104175670 2022-04-13 15:13:00
5       SDWA_PUB_WATER_SYSTEMS.csv  126596558 2022-04-13 15:14:00
6      SDWA_PN_VIOLATION_ASSOC.csv   31721515 2022-04-13 15:14:00
7          SDWA_REF_ANSI_AREAS.csv      86159 2022-04-13 15:14:00
8         SDWA_REF_CODE_VALUES.csv     117171 2022-04-13 15:14:00
9           SDWA_SERVICE_AREAS.csv   18901420 2022-04-13 15:15:00
10            SDWA_SITE_VISITS.csv  336423869 2022-04-13 15:17:00
11 SDWA_VIOLATIONS_ENFORCEMENT.csv 3208856416 2022-04-13 15:41:00</code></pre>
</div>
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">unzip</span>(<span class="st">"data/sdwa.zip"</span>, <span class="at">list =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>Date[<span class="dv">11</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We load the violations table and filter to violations that end later than April 13, 2020, two years before the the most current data was released.</p>
<div class="cell">
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">&lt;-</span> end_date <span class="sc">-</span> <span class="dv">365</span><span class="sc">*</span><span class="dv">2</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>violators <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="st">"data/SDWA_VIOLATIONS_ENFORCEMENT.csv"</span>, <span class="co"># read data</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">"c"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(IS_HEALTH_BASED_IND <span class="sc">==</span> <span class="st">"Y"</span>) <span class="sc">%&gt;%</span> <span class="co"># select only health-based violations</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="co">#format dates as dates</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">as.Date</span>(COMPL_PER_BEGIN_DATE, </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">format =</span> <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">end =</span> <span class="fu">pmin</span>(<span class="fu">as.Date</span>(CALCULATED_RTC_DATE,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">format =</span> <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                              end_date)) <span class="co"># set end date to most current report date</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="calculate-the-number-of-days-in-health-based-violation-by-each-cws-within-this-period" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="calculate-the-number-of-days-in-health-based-violation-by-each-cws-within-this-period"><span class="header-section-number">3.2</span> Calculate the number of days in health-based violation by each CWS within this period</h3>
<div class="cell">
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>violators <span class="ot">&lt;-</span> violators <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">violation_duration =</span> end <span class="sc">-</span> start</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="filter-to-cws-with-greater-than-30-such-days" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="filter-to-cws-with-greater-than-30-such-days"><span class="header-section-number">3.3</span> Filter to CWS with greater than 30 such days</h3>
<div class="cell">
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>violators <span class="ot">&lt;-</span> violators <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(end <span class="sc">&gt;=</span> start_date) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(violation_duration <span class="sc">&gt;=</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(PWSID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="filter-the-temm-national-water-service-boundary-layer-to-those-states-with-comprehensive-non-county-based-tier-1-boundaries-plus-utah" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="filter-the-temm-national-water-service-boundary-layer-to-those-states-with-comprehensive-non-county-based-tier-1-boundaries-plus-utah"><span class="header-section-number">3.4</span> Filter the TEMM national water service boundary layer to those states with comprehensive, non-county-based Tier 1 boundaries, plus Utah</h3>
<p>First we download and compress the TEMM layer for quick access in later parts of the workflow</p>
<div class="cell">
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">"https://www.hydroshare.org/django_irods/rest_download/6f3386bb4bc945028391cfabf1ea252e/data/contents/temm_layer_v1.0.0/temm.geojson/?url_download=True&amp;zipped=False&amp;aggregation=False"</span>, <span class="at">destfile =</span> <span class="st">"data/temm.geojson"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>temm <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">"data/temm.geojson"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">qsave</span>(temm, <span class="at">file =</span> <span class="st">"data/temm.qs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we load the file, and filter for only the states with comprehensive Tier 1 availability (AZ, CA, CT, KS, NJ, NM, OK, PA, TX, WA) as well as Utah for comparison. We also load in Utah’s data for Culinwary Water Service Areas, filtering for Community Water Systems, which was not included in the original TEMM layer but has been created by Utah DWR, to compare performance between TEMM estimation methods and Tier 1 if possible.</p>
<div class="cell">
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>temm <span class="ot">&lt;-</span> <span class="fu">qread</span>(<span class="st">"data/temm.qs"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AZ"</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"CA"</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"CT"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"KS"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"NJ"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"NM"</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"OK"</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"PA"</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"TX"</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"UT"</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"WA"</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>utah <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">"https://services.arcgis.com/ZzrwjTRez6FJiOq4/arcgis/rest/services/CulinaryWaterServiceAreas/FeatureServer/0/query?where=1%3D1&amp;objectIds=&amp;time=&amp;geometry=&amp;geometryType=esriGeometryEnvelope&amp;inSR=&amp;spatialRel=esriSpatialRelIntersects&amp;resultType=none&amp;distance=0.0&amp;units=esriSRUnit_Meter&amp;returnGeodetic=false&amp;outFields=*&amp;returnGeometry=true&amp;returnCentroid=false&amp;featureEncoding=esriDefault&amp;multipatchOption=xyFootprint&amp;maxAllowableOffset=&amp;geometryPrecision=&amp;outSR=4326&amp;defaultSR=&amp;datumTransformation=&amp;applyVCSProjection=false&amp;returnIdsOnly=false&amp;returnUniqueIdsOnly=false&amp;returnCountOnly=false&amp;returnExtentOnly=false&amp;returnQueryGeometry=false&amp;returnDistinctValues=false&amp;cacheHint=false&amp;orderByFields=&amp;groupByFieldsForStatistics=&amp;outStatistics=&amp;having=&amp;resultOffset=&amp;resultRecordCount=&amp;returnZ=false&amp;returnM=false&amp;returnExceededLimitFeatures=true&amp;quantizationParameters=&amp;sqlFormat=none&amp;f=pgeojson"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SYSTEMTYPE <span class="sc">==</span> <span class="st">"C"</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>boundaries <span class="ot">&lt;-</span> temm <span class="sc">%&gt;%</span> <span class="fu">filter</span>(</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  state_code <span class="sc">%in%</span> states</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>service_area_type_code)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="filter-the-cejst-census-tracts-to-the-same-states" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="filter-the-cejst-census-tracts-to-the-same-states"><span class="header-section-number">3.5</span> Filter the CEJST Census Tracts to the same states</h3>
<p>First we download and unzip the data</p>
<div class="cell">
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">"https://static-data-screeningtool.geoplatform.gov/data-pipeline/data/score/shapefile/usa.zip"</span>, <span class="at">destfile =</span> <span class="st">"data/j40.zip"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">"data/j40.zip"</span>, <span class="at">exdir =</span> <span class="st">"data/j40"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then we load it and the data dictionary</p>
<div class="cell">
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>j40 <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">"data/j40/usa.shp"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>j40_dict <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="st">"data/j40/columns.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 110 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): shapefile_column, column_name, column_description

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
</section>
<section id="filter-to-the-resulting-set-of-cws-with-violations" class="level3" data-number="3.6">
<h3 data-number="3.6" class="anchored" data-anchor-id="filter-to-the-resulting-set-of-cws-with-violations"><span class="header-section-number">3.6</span> Filter to the resulting set of CWS with violations</h3>
<div class="cell">
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> boundaries <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pwsid <span class="sc">%in%</span> violators<span class="sc">$</span>PWSID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="assign-the-indicator-to-cejst-census-tracts-that-spatially-intersect-this-set-of-cws" class="level3" data-number="3.7">
<h3 data-number="3.7" class="anchored" data-anchor-id="assign-the-indicator-to-cejst-census-tracts-that-spatially-intersect-this-set-of-cws"><span class="header-section-number">3.7</span> Assign the indicator to CEJST Census Tracts that spatially intersect this set of CWS</h3>
<p>First we spatially intersect the set of CWS boundaries with the threshold period of health-based violations to the CEJST version of the 2010 U.S. Census Tracts. We also do Utah separately. Caveats:</p>
<ul>
<li><p>I am not setting a threshold for how large an overlap between a census tract and a utility needs to be. A census tract may have only a small portion covered by a utility and we are counting it. There are two scenarios:</p>
<ul>
<li><p>A relatively large system only serves part of a tract on its periphery</p></li>
<li><p>A small system with a tier 1 boundary like a mobile home park or golf course community lies completely within a tract much larger than it</p></li>
<li><p>I have not quantified this yet</p></li>
</ul></li>
</ul>
<div class="cell">
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>states2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Arizona"</span>,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">"California"</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Connecticut"</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Kansas"</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"New Jersey"</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"New Mexico"</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Oklahoma"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Pennsylvania"</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Texas"</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Utah"</span>,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Washington"</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>j40 <span class="ot">&lt;-</span> j40 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  SF <span class="sc">%in%</span> states2</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>v1 <span class="ot">&lt;-</span> v <span class="sc">%&gt;%</span> <span class="fu">filter</span>(state_code <span class="sc">==</span> states[<span class="dv">1</span>])</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>j1 <span class="ot">&lt;-</span> j40 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SF <span class="sc">==</span> states2[<span class="dv">1</span>])</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>v_j40 <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(v1,j1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>although coordinates are longitude/latitude, st_intersection assumes that they are planar</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout all
geometries</code></pre>
</div>
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(states)){</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  v1 <span class="ot">&lt;-</span> v <span class="sc">%&gt;%</span> <span class="fu">filter</span>(state_code <span class="sc">==</span> states[i])</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  j1 <span class="ot">&lt;-</span> j40 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SF <span class="sc">==</span> states2[i])</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  v_j40_1 <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(v1,j1)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  v_j40 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(v_j40,v_j40_1)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(i))</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>although coordinates are longitude/latitude, st_intersection assumes that they are planar</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout all
geometries</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>although coordinates are longitude/latitude, st_intersection assumes that they are planar</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout all
geometries</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "3"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>although coordinates are longitude/latitude, st_intersection assumes that they are planar</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout all
geometries</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "4"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>although coordinates are longitude/latitude, st_intersection assumes that they are planar</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout all
geometries</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "5"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>although coordinates are longitude/latitude, st_intersection assumes that they are planar</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout all
geometries</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "6"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>although coordinates are longitude/latitude, st_intersection assumes that they are planar</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout all
geometries</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "7"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>although coordinates are longitude/latitude, st_intersection assumes that they are planar</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout all
geometries</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "8"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>although coordinates are longitude/latitude, st_intersection assumes that they are planar</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout all
geometries</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "9"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>although coordinates are longitude/latitude, st_intersection assumes that they are planar</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout all
geometries</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "10"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>although coordinates are longitude/latitude, st_intersection assumes that they are planar</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout all
geometries</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "11"</code></pre>
</div>
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>v_utah <span class="ot">&lt;-</span> utah <span class="sc">%&gt;%</span> <span class="fu">filter</span>(DWSYSNUM <span class="sc">%in%</span> v<span class="sc">$</span>pwsid)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>j_utah <span class="ot">&lt;-</span> j40 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SF <span class="sc">==</span> <span class="st">"Utah"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>v_j40_utah <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(v_utah,j_utah)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>although coordinates are longitude/latitude, st_intersection assumes that they are planar</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout all
geometries</code></pre>
</div>
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qsave</span>(v_j40,<span class="st">"data/viol_pws_j40.qs"</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qsave</span>(v_j40_utah, <span class="st">"data/viol_pws_j40_utah.qs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, we need to construct indicator as framed by CEJST, meaning we assign to each Census tract a binary indicator as to whether it intersects a violating water system as well as meeting the socioeconomic threshold set by the CEJST (&gt;65th percentile for percentage of population living on incomes &lt;200% of the Federal Poverty line and with 80% or more of adults &gt;15 not enrolled in higher education). We also only allow for Tier 1 and Tier 2a matches, removing all Tier 2b and Tier 3 matches.</p>
<div class="cell">
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>states2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Arizona"</span>,</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">"California"</span>,</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Connecticut"</span>,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Kansas"</span>,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"New Jersey"</span>,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"New Mexico"</span>,</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Oklahoma"</span>,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Pennsylvania"</span>,</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Texas"</span>,</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Utah"</span>,</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Washington"</span>)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>j40 <span class="ot">&lt;-</span> j40 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>  SF <span class="sc">%in%</span> states2</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>v_j40_utah <span class="ot">&lt;-</span> <span class="fu">qread</span>(<span class="st">"data/viol_pws_j40_utah.qs"</span>) </span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>v_j40 <span class="ot">&lt;-</span> <span class="fu">qread</span>(<span class="st">"data/viol_pws_j40.qs"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(tier <span class="sc">==</span> <span class="st">"Tier 1"</span> <span class="sc">|</span> tier <span class="sc">==</span> <span class="st">"Tier 2a"</span>)</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>v_j40 <span class="ot">&lt;-</span> v_j40 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(SF <span class="sc">!=</span> <span class="st">"Utah"</span>)</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>j40_dw <span class="ot">&lt;-</span> j40 <span class="sc">%&gt;%</span> </span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>   <span class="at">DW =</span> <span class="fu">case_when</span>(GEOID10 <span class="sc">%in%</span> v_j40<span class="sc">$</span>GEOID10 <span class="sc">~</span> <span class="st">"SDWA Violation Present"</span>,</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>                       <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"SDWA Violation Not Present"</span>), <span class="co"># DW indicator with Tier 2 Utah </span></span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>   <span class="at">DW_ut1 =</span> <span class="fu">case_when</span>( ((GEOID10 <span class="sc">%in%</span> v_j40<span class="sc">$</span>GEOID10 <span class="sc">&amp;</span> SF <span class="sc">!=</span> <span class="st">"Utah"</span>) <span class="sc">|</span> (GEOID10 <span class="sc">%in%</span> v_j40_utah<span class="sc">$</span>GEOID10)) <span class="sc">~</span> <span class="st">"SDWA Violation Present"</span>,</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>                       <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"SDWA Violation Not Present"</span>) <span class="co"># DW indicator with Tier 1 Utah</span></span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>j40_dw <span class="ot">&lt;-</span> j40_dw <span class="sc">%&gt;%</span></span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">dw_disadv =</span> (DW <span class="sc">==</span> <span class="st">"SDWA Violation Present"</span> <span class="sc">&amp;</span> M_EBSI <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">dw_disadv_ut1 =</span> (DW_ut1 <span class="sc">==</span> <span class="st">"SDWA Violation Present"</span> <span class="sc">&amp;</span> M_EBSI <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="calculate-and-compare-summary-statistics-for-the-original-set-of-cejst-tracts-in-the-filtered-states-and-the-new-set-by-state-including" class="level3" data-number="3.8">
<h3 data-number="3.8" class="anchored" data-anchor-id="calculate-and-compare-summary-statistics-for-the-original-set-of-cejst-tracts-in-the-filtered-states-and-the-new-set-by-state-including"><span class="header-section-number">3.8</span> Calculate and compare summary statistics for the original set of CEJST tracts (in the filtered states) and the new set, by state, including:</h3>
<p>counts</p>
<p>Tract counts in selected states by Drinking Water indicator and current CEJST disadvantage status</p>
<div class="cell">
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>j40_dw <span class="ot">&lt;-</span> j40_dw <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">CEJST_disadv =</span> <span class="fu">case_when</span>(</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>      SM_C <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"CEJST disadvantaged"</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Not CEJST disadvantaged"</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">CEJST_income_educ_threshold =</span> <span class="fu">case_when</span>(</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>      M_EBSI <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"CEJST 'low' inc/edu"</span>,</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"CEJST 'high' inc/edu"</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span>  j40_dw <span class="sc">%&gt;%</span> <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(DW_ut1,CEJST_disadv) <span class="sc">%&gt;%</span> </span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="at">where =</span> <span class="fu">c</span>(<span class="st">"row"</span>,<span class="st">"col"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_percentages</span>(<span class="st">"col"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>() <span class="sc">%&gt;%</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_ns</span>() </span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 31%">
<col style="width: 23%">
<col style="width: 27%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">DW_ut1</th>
<th style="text-align: left;">CEJST disadvantaged</th>
<th style="text-align: left;">Not CEJST disadvantaged</th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SDWA Violation Not Present</td>
<td style="text-align: left;">88.1% (7135)</td>
<td style="text-align: left;">89.2% (15324)</td>
<td style="text-align: left;">88.9% (22459)</td>
</tr>
<tr class="even">
<td style="text-align: left;">SDWA Violation Present</td>
<td style="text-align: left;">11.9% (961)</td>
<td style="text-align: left;">10.8% (1850)</td>
<td style="text-align: left;">11.1% (2811)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">100.0% (8096)</td>
<td style="text-align: left;">100.0% (17174)</td>
<td style="text-align: left;">100.0% (25270)</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>Tract counts in selected states by Drinking Water indicator and current CEJST disadvantage status by State</p>
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>j40_dw <span class="ot">&lt;-</span> j40_dw <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">CEJST_disadv =</span> <span class="fu">case_when</span>(</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>      SM_C <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"CEJST disadvantaged"</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Not CEJST disadvantaged"</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">CEJST_income_educ_threshold =</span> <span class="fu">case_when</span>(</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>      M_EBSI <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"CEJST 'low' inc/edu"</span>,</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"CEJST 'high' inc/edu"</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>j40_dw <span class="sc">%&gt;%</span> <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(DW_ut1,CEJST_disadv,SF) <span class="sc">%&gt;%</span> </span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="at">where =</span> <span class="fu">c</span>(<span class="st">"row"</span>,<span class="st">"col"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_percentages</span>(<span class="st">"col"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>() <span class="sc">%&gt;%</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_ns</span>() <span class="sc">%&gt;%</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">walk2</span>(<span class="fu">names</span>(.), <span class="sc">~</span> <span class="fu">print</span>(<span class="fu">kable</span>(.x, <span class="at">caption =</span> .y)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table">
<caption>Arizona</caption>
<colgroup>
<col style="width: 31%">
<col style="width: 23%">
<col style="width: 28%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">DW_ut1</th>
<th style="text-align: left;">CEJST disadvantaged</th>
<th style="text-align: left;">Not CEJST disadvantaged</th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SDWA Violation Not Present</td>
<td style="text-align: left;">92.9% (459)</td>
<td style="text-align: left;">96.3% (994)</td>
<td style="text-align: left;">95.2% (1453)</td>
</tr>
<tr class="even">
<td style="text-align: left;">SDWA Violation Present</td>
<td style="text-align: left;">7.1% (35)</td>
<td style="text-align: left;">3.7% (38)</td>
<td style="text-align: left;">4.8% (73)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">100.0% (494)</td>
<td style="text-align: left;">100.0% (1032)</td>
<td style="text-align: left;">100.0% (1526)</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>California</caption>
<colgroup>
<col style="width: 31%">
<col style="width: 23%">
<col style="width: 28%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">DW_ut1</th>
<th style="text-align: left;">CEJST disadvantaged</th>
<th style="text-align: left;">Not CEJST disadvantaged</th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SDWA Violation Not Present</td>
<td style="text-align: left;">96.8% (2815)</td>
<td style="text-align: left;">98.0% (5049)</td>
<td style="text-align: left;">97.6% (7864)</td>
</tr>
<tr class="even">
<td style="text-align: left;">SDWA Violation Present</td>
<td style="text-align: left;">3.2% (92)</td>
<td style="text-align: left;">2.0% (101)</td>
<td style="text-align: left;">2.4% (193)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">100.0% (2907)</td>
<td style="text-align: left;">100.0% (5150)</td>
<td style="text-align: left;">100.0% (8057)</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Connecticut</caption>
<colgroup>
<col style="width: 32%">
<col style="width: 23%">
<col style="width: 28%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">DW_ut1</th>
<th style="text-align: left;">CEJST disadvantaged</th>
<th style="text-align: left;">Not CEJST disadvantaged</th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SDWA Violation Not Present</td>
<td style="text-align: left;">96.5% (165)</td>
<td style="text-align: left;">95.8% (634)</td>
<td style="text-align: left;">95.9% (799)</td>
</tr>
<tr class="even">
<td style="text-align: left;">SDWA Violation Present</td>
<td style="text-align: left;">3.5% (6)</td>
<td style="text-align: left;">4.2% (28)</td>
<td style="text-align: left;">4.1% (34)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">100.0% (171)</td>
<td style="text-align: left;">100.0% (662)</td>
<td style="text-align: left;">100.0% (833)</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Kansas</caption>
<colgroup>
<col style="width: 32%">
<col style="width: 23%">
<col style="width: 28%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">DW_ut1</th>
<th style="text-align: left;">CEJST disadvantaged</th>
<th style="text-align: left;">Not CEJST disadvantaged</th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SDWA Violation Not Present</td>
<td style="text-align: left;">90.2% (184)</td>
<td style="text-align: left;">81.3% (460)</td>
<td style="text-align: left;">83.6% (644)</td>
</tr>
<tr class="even">
<td style="text-align: left;">SDWA Violation Present</td>
<td style="text-align: left;">9.8% (20)</td>
<td style="text-align: left;">18.7% (106)</td>
<td style="text-align: left;">16.4% (126)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">100.0% (204)</td>
<td style="text-align: left;">100.0% (566)</td>
<td style="text-align: left;">100.0% (770)</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>New Jersey</caption>
<colgroup>
<col style="width: 31%">
<col style="width: 23%">
<col style="width: 28%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">DW_ut1</th>
<th style="text-align: left;">CEJST disadvantaged</th>
<th style="text-align: left;">Not CEJST disadvantaged</th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SDWA Violation Not Present</td>
<td style="text-align: left;">61.2% (301)</td>
<td style="text-align: left;">68.1% (1033)</td>
<td style="text-align: left;">66.4% (1334)</td>
</tr>
<tr class="even">
<td style="text-align: left;">SDWA Violation Present</td>
<td style="text-align: left;">38.8% (191)</td>
<td style="text-align: left;">31.9% (485)</td>
<td style="text-align: left;">33.6% (676)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">100.0% (492)</td>
<td style="text-align: left;">100.0% (1518)</td>
<td style="text-align: left;">100.0% (2010)</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>New Mexico</caption>
<colgroup>
<col style="width: 32%">
<col style="width: 23%">
<col style="width: 28%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">DW_ut1</th>
<th style="text-align: left;">CEJST disadvantaged</th>
<th style="text-align: left;">Not CEJST disadvantaged</th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SDWA Violation Not Present</td>
<td style="text-align: left;">73.0% (165)</td>
<td style="text-align: left;">89.4% (244)</td>
<td style="text-align: left;">82.0% (409)</td>
</tr>
<tr class="even">
<td style="text-align: left;">SDWA Violation Present</td>
<td style="text-align: left;">27.0% (61)</td>
<td style="text-align: left;">10.6% (29)</td>
<td style="text-align: left;">18.0% (90)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">100.0% (226)</td>
<td style="text-align: left;">100.0% (273)</td>
<td style="text-align: left;">100.0% (499)</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Oklahoma</caption>
<colgroup>
<col style="width: 31%">
<col style="width: 23%">
<col style="width: 28%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">DW_ut1</th>
<th style="text-align: left;">CEJST disadvantaged</th>
<th style="text-align: left;">Not CEJST disadvantaged</th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SDWA Violation Not Present</td>
<td style="text-align: left;">66.5% (300)</td>
<td style="text-align: left;">78.0% (464)</td>
<td style="text-align: left;">73.0% (764)</td>
</tr>
<tr class="even">
<td style="text-align: left;">SDWA Violation Present</td>
<td style="text-align: left;">33.5% (151)</td>
<td style="text-align: left;">22.0% (131)</td>
<td style="text-align: left;">27.0% (282)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">100.0% (451)</td>
<td style="text-align: left;">100.0% (595)</td>
<td style="text-align: left;">100.0% (1046)</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Pennsylvania</caption>
<colgroup>
<col style="width: 31%">
<col style="width: 23%">
<col style="width: 28%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">DW_ut1</th>
<th style="text-align: left;">CEJST disadvantaged</th>
<th style="text-align: left;">Not CEJST disadvantaged</th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SDWA Violation Not Present</td>
<td style="text-align: left;">87.4% (653)</td>
<td style="text-align: left;">85.1% (2102)</td>
<td style="text-align: left;">85.6% (2755)</td>
</tr>
<tr class="even">
<td style="text-align: left;">SDWA Violation Present</td>
<td style="text-align: left;">12.6% (94)</td>
<td style="text-align: left;">14.9% (369)</td>
<td style="text-align: left;">14.4% (463)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">100.0% (747)</td>
<td style="text-align: left;">100.0% (2471)</td>
<td style="text-align: left;">100.0% (3218)</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Texas</caption>
<colgroup>
<col style="width: 31%">
<col style="width: 23%">
<col style="width: 28%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">DW_ut1</th>
<th style="text-align: left;">CEJST disadvantaged</th>
<th style="text-align: left;">Not CEJST disadvantaged</th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SDWA Violation Not Present</td>
<td style="text-align: left;">85.8% (1776)</td>
<td style="text-align: left;">86.0% (2748)</td>
<td style="text-align: left;">85.9% (4524)</td>
</tr>
<tr class="even">
<td style="text-align: left;">SDWA Violation Present</td>
<td style="text-align: left;">14.2% (293)</td>
<td style="text-align: left;">14.0% (448)</td>
<td style="text-align: left;">14.1% (741)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">100.0% (2069)</td>
<td style="text-align: left;">100.0% (3196)</td>
<td style="text-align: left;">100.0% (5265)</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Utah</caption>
<colgroup>
<col style="width: 32%">
<col style="width: 23%">
<col style="width: 28%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">DW_ut1</th>
<th style="text-align: left;">CEJST disadvantaged</th>
<th style="text-align: left;">Not CEJST disadvantaged</th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SDWA Violation Not Present</td>
<td style="text-align: left;">94.7% (72)</td>
<td style="text-align: left;">86.3% (442)</td>
<td style="text-align: left;">87.4% (514)</td>
</tr>
<tr class="even">
<td style="text-align: left;">SDWA Violation Present</td>
<td style="text-align: left;">5.3% (4)</td>
<td style="text-align: left;">13.7% (70)</td>
<td style="text-align: left;">12.6% (74)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">100.0% (76)</td>
<td style="text-align: left;">100.0% (512)</td>
<td style="text-align: left;">100.0% (588)</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>Washington</caption>
<colgroup>
<col style="width: 31%">
<col style="width: 23%">
<col style="width: 28%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">DW_ut1</th>
<th style="text-align: left;">CEJST disadvantaged</th>
<th style="text-align: left;">Not CEJST disadvantaged</th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SDWA Violation Not Present</td>
<td style="text-align: left;">94.6% (245)</td>
<td style="text-align: left;">96.2% (1154)</td>
<td style="text-align: left;">96.0% (1399)</td>
</tr>
<tr class="even">
<td style="text-align: left;">SDWA Violation Present</td>
<td style="text-align: left;">5.4% (14)</td>
<td style="text-align: left;">3.8% (45)</td>
<td style="text-align: left;">4.0% (59)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">100.0% (259)</td>
<td style="text-align: left;">100.0% (1199)</td>
<td style="text-align: left;">100.0% (1458)</td>
</tr>
</tbody>
</table></li>
<li><p>Tract counts in selected states by Drinking Water indicator and current CEJST disadvantage status, by the CEJST non-student low-income socioeconomic indicator</p></li>
</ul>
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span>j40_dw <span class="sc">%&gt;%</span> <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(DW_ut1,CEJST_disadv,CEJST_income_educ_threshold) <span class="sc">%&gt;%</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="at">where =</span> <span class="fu">c</span>(<span class="st">"row"</span>,<span class="st">"col"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_percentages</span>(<span class="st">"col"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_ns</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">walk2</span>(<span class="fu">names</span>(.), <span class="sc">~</span> <span class="fu">print</span>(<span class="fu">kable</span>(.x, <span class="at">caption =</span> .y)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table">
<caption>CEJST ‘high’ inc/edu</caption>
<colgroup>
<col style="width: 31%">
<col style="width: 23%">
<col style="width: 27%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">DW_ut1</th>
<th style="text-align: left;">CEJST disadvantaged</th>
<th style="text-align: left;">Not CEJST disadvantaged</th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SDWA Violation Not Present</td>
<td style="text-align: left;">91.2% (719)</td>
<td style="text-align: left;">89.2% (14794)</td>
<td style="text-align: left;">89.3% (15513)</td>
</tr>
<tr class="even">
<td style="text-align: left;">SDWA Violation Present</td>
<td style="text-align: left;">8.8% (69)</td>
<td style="text-align: left;">10.8% (1783)</td>
<td style="text-align: left;">10.7% (1852)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">100.0% (788)</td>
<td style="text-align: left;">100.0% (16577)</td>
<td style="text-align: left;">100.0% (17365)</td>
</tr>
</tbody>
</table>
<table class="table">
<caption>CEJST ‘low’ inc/edu</caption>
<colgroup>
<col style="width: 31%">
<col style="width: 23%">
<col style="width: 28%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">DW_ut1</th>
<th style="text-align: left;">CEJST disadvantaged</th>
<th style="text-align: left;">Not CEJST disadvantaged</th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SDWA Violation Not Present</td>
<td style="text-align: left;">87.8% (6416)</td>
<td style="text-align: left;">88.8% (530)</td>
<td style="text-align: left;">87.9% (6946)</td>
</tr>
<tr class="even">
<td style="text-align: left;">SDWA Violation Present</td>
<td style="text-align: left;">12.2% (892)</td>
<td style="text-align: left;">11.2% (67)</td>
<td style="text-align: left;">12.1% (959)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">100.0% (7308)</td>
<td style="text-align: left;">100.0% (597)</td>
<td style="text-align: left;">100.0% (7905)</td>
</tr>
</tbody>
</table>
<ul>
<li>total population (see <a href="https://cgs-earth.github.io/epic-wsb-national-case-study/map.html">map</a>)</li>
</ul>
<div class="cell">
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>pop_by_tract_type <span class="ot">&lt;-</span> j40_dw <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CEJST_disadv,dw_disadv_ut1) <span class="sc">%&gt;%</span> </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">population =</span> <span class="fu">sum</span>(TPF,<span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'CEJST_disadv'. You can override using the
`.groups` argument.
although coordinates are longitude/latitude, st_union assumes that they are
planar
although coordinates are longitude/latitude, st_union assumes that they are
planar
although coordinates are longitude/latitude, st_union assumes that they are
planar
although coordinates are longitude/latitude, st_union assumes that they are
planar</code></pre>
</div>
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>j40_types <span class="ot">&lt;-</span> j40_dw <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cat1 =</span> <span class="fu">case_when</span>(</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    dw_disadv_ut1 <span class="sc">&amp;</span> CEJST_disadv <span class="sc">==</span> <span class="st">"CEJST disadvantaged"</span>  <span class="sc">~</span> <span class="st">"DW EJ indicator + Current CEJST"</span>,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>dw_disadv_ut1 <span class="sc">&amp;</span> CEJST_disadv <span class="sc">==</span> <span class="st">"CEJST disadvantaged"</span>  <span class="sc">~</span> <span class="st">"No DW EJ indicator + Current CEJST"</span>,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>dw_disadv_ut1 <span class="sc">&amp;</span> CEJST_disadv <span class="sc">==</span> <span class="st">"Not CEJST disadvantaged"</span>  <span class="sc">~</span> <span class="st">"No DW EJ indicator + Not Current CEJST"</span>,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    dw_disadv_ut1 <span class="sc">&amp;</span> CEJST_disadv <span class="sc">==</span> <span class="st">"Not CEJST disadvantaged"</span>  <span class="sc">~</span> <span class="st">"DW EJ indicator + Not Current CEJST"</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">cat2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>         DW_ut1<span class="sc">==</span><span class="st">"SDWA Violation Present"</span> <span class="sc">&amp;</span> CEJST_disadv <span class="sc">==</span> <span class="st">"CEJST disadvantaged"</span>  <span class="sc">~</span> <span class="st">"DW violation + Current CEJST"</span>,</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    DW_ut1<span class="sc">==</span><span class="st">"SDWA Violation Not Present"</span> <span class="sc">&amp;</span> CEJST_disadv <span class="sc">==</span> <span class="st">"CEJST disadvantaged"</span>  <span class="sc">~</span> <span class="st">"No DW violation + Current CEJST"</span>,</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    DW_ut1<span class="sc">==</span><span class="st">"SDWA Violation Not Present"</span> <span class="sc">&amp;</span> CEJST_disadv <span class="sc">==</span> <span class="st">"Not CEJST disadvantaged"</span>  <span class="sc">~</span> <span class="st">"No DW violation + Not Current CEJST"</span>,</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    DW_ut1<span class="sc">==</span><span class="st">"SDWA Violation Present"</span> <span class="sc">&amp;</span> CEJST_disadv <span class="sc">==</span> <span class="st">"Not CEJST disadvantaged"</span>  <span class="sc">~</span> <span class="st">"DW violation + Not Current CEJST"</span>   </span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>        )) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>j40_types_1 <span class="ot">&lt;-</span> j40_types <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cat1) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">pop=</span><span class="fu">sum</span>(TPF,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>although coordinates are longitude/latitude, st_union assumes that they are planar
although coordinates are longitude/latitude, st_union assumes that they are planar
although coordinates are longitude/latitude, st_union assumes that they are planar
although coordinates are longitude/latitude, st_union assumes that they are planar</code></pre>
</div>
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>j40_types_2 <span class="ot">&lt;-</span> j40_types <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cat2) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">pop=</span><span class="fu">sum</span>(TPF,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>although coordinates are longitude/latitude, st_union assumes that they are planar
although coordinates are longitude/latitude, st_union assumes that they are planar
although coordinates are longitude/latitude, st_union assumes that they are planar
although coordinates are longitude/latitude, st_union assumes that they are planar</code></pre>
</div>
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> pop_by_tract_type <span class="sc">%&gt;%</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pop_millions =</span> population<span class="sc">/</span><span class="dv">1000000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>population) <span class="sc">%&gt;%</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>dw_disadv_ut1, <span class="at">values_from =</span> pop_millions) <span class="sc">%&gt;%</span> </span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">DW Violation + low income</span><span class="st">`</span><span class="ot">=</span><span class="st">`</span><span class="at">TRUE</span><span class="st">`</span>,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>                                                                                                                                 <span class="st">`</span><span class="at">No DW Violation or not low income</span><span class="st">`</span><span class="ot">=</span><span class="st">`</span><span class="at">FALSE</span><span class="st">`</span>)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 28%">
<col style="width: 40%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">CEJST_disadv</th>
<th style="text-align: right;">No DW Violation or not low income</th>
<th style="text-align: right;">DW Violation + low income</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CEJST disadvantaged</td>
<td style="text-align: right;">32.18822</td>
<td style="text-align: right;">3.655508</td>
</tr>
<tr class="even">
<td style="text-align: left;">Not CEJST disadvantaged</td>
<td style="text-align: right;">82.27428</td>
<td style="text-align: right;">0.338452</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Map 1: Census Tracts categorized by drinking water violations and current CEJST status</p>
<div class="cell">
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mapviewOptions</span>(<span class="at">fgb =</span> <span class="cn">TRUE</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>m1<span class="ot">&lt;-</span>mapview<span class="sc">::</span><span class="fu">mapview</span>(j40_types_2, <span class="at">zcol=</span><span class="st">"cat2"</span>, <span class="at">layer.name=</span><span class="st">"Tract Category"</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>mapview<span class="sc">::</span><span class="fu">mapshot</span>(m1,<span class="at">url=</span><span class="st">"map1.html"</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>m1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="htmlwidget-f6e8db62908c771ab8ff" style="width:100%;height:464px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-f6e8db62908c771ab8ff">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":true,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addFlatGeoBuf","args":["TractCategory","Tract Category",null,true,"cat2",{"radius":6,"stroke":true,"color":"#333333","weight":0.5,"opacity":0.9,"fill":true,"fillColor":null,"fillOpacity":0.6},{"className":""},"mapview-popup",{"radius":{"to":[3,15],"from":[3,15]},"weight":{"to":[1,10],"from":[1,10]},"opacity":{"to":[0,1],"from":[0,1]},"fillOpacity":{"to":[0,1],"from":[0,1]}}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-124.848974,25.837164,-71.787239,49.002494,true,"Tract Category","Zoom to Tract Category","<strong> Tract Category <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"Tract Category",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#4B0055","#007094","#00BE7D","#FDE333"],"labels":["DW violation + Current CEJST","DW violation + Not Current CEJST","No DW violation + Current CEJST","No DW violation + Not Current CEJST"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"Tract Category","extra":null,"layerId":null,"className":"info legend","group":"Tract Category"}]}],"fitBounds":[25.837164,-124.848974,49.002494,-71.787239,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
<p>Map 2: Census Tracts categorized by provisional drinking water EJ indicator (drinking water violation + low income) and current CEJST status</p>
<div class="cell">
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mapviewOptions</span>(<span class="at">fgb =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>m2<span class="ot">&lt;-</span>mapview<span class="sc">::</span><span class="fu">mapview</span>(j40_types_1, <span class="at">zcol=</span><span class="st">"cat1"</span>, <span class="at">layer.name=</span><span class="st">"Tract Category"</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>mapview<span class="sc">::</span><span class="fu">mapshot</span>(m2,<span class="at">url=</span><span class="st">"map2.html"</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>m2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="htmlwidget-286104497bc57c476933" style="width:100%;height:464px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-286104497bc57c476933">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":true,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addFlatGeoBuf","args":["TractCategory","Tract Category",null,true,"cat1",{"radius":6,"stroke":true,"color":"#333333","weight":0.5,"opacity":0.9,"fill":true,"fillColor":null,"fillOpacity":0.6},{"className":""},"mapview-popup",{"radius":{"to":[3,15],"from":[3,15]},"weight":{"to":[1,10],"from":[1,10]},"opacity":{"to":[0,1],"from":[0,1]},"fillOpacity":{"to":[0,1],"from":[0,1]}}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-124.848974,25.837164,-71.787239,49.002494,true,"Tract Category","Zoom to Tract Category","<strong> Tract Category <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"Tract Category",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#4B0055","#007094","#00BE7D","#FDE333"],"labels":["DW EJ indicator + Current CEJST","DW EJ indicator + Not Current CEJST","No DW EJ indicator + Current CEJST","No DW EJ indicator + Not Current CEJST"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"Tract Category","extra":null,"layerId":null,"className":"info legend","group":"Tract Category"}]}],"fitBounds":[25.837164,-124.848974,49.002494,-71.787239,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
<ul>
<li>measures of income distribution</li>
</ul>
<div class="cell">
<details>
<summary>show the code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">census_api_key</span>(<span class="st">"b25f8b1b7bf10561c9cbc3a20a4d2572677f1f05"</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tigris_use_cache =</span> <span class="cn">TRUE</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>tr <span class="ot">&lt;-</span> tidycensus<span class="sc">::</span><span class="fu">get_acs</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>race/ethnicity population distributions</li>
</ul>
</section>
</section>
<section id="discussion" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="discussion"><span class="header-section-number">4</span> Discussion</h2>
<p>Will discuss results in detail here.</p>
<section id="headline-1" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="headline-1"><span class="header-section-number">4.1</span> Headline 1:</h3>
<p>959 “poor” tract/communities across the 11 states were identified to have safe drinking water violations, 67 of which were not previously identified as disadvantaged in the CEJST</p>
<!-- -->


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-allaire2018" class="csl-entry" role="doc-biblioentry">
Allaire, Maura, Haowei Wu, and Upmanu Lall. 2018. <span>“National Trends in Drinking Water Quality Violations.”</span> <em>Proceedings of the National Academy of Sciences</em> 115 (9): 2078–83. <a href="https://doi.org/10.1073/pnas.1719805115">https://doi.org/10.1073/pnas.1719805115</a>.
</div>
<div id="ref-dobbin2021" class="csl-entry" role="doc-biblioentry">
Dobbin, Kristin B., and Amanda L. Fencl. 2021. <span>“Institutional Diversity and Safe Drinking Water Provision in the United States.”</span> <em>Utilities Policy</em> 73 (December): 101306. <a href="https://doi.org/10.1016/j.jup.2021.101306">https://doi.org/10.1016/j.jup.2021.101306</a>.
</div>
<div id="ref-konisky2015" class="csl-entry" role="doc-biblioentry">
Konisky, David M., and Manuel P. Teodoro. 2015. <span>“When Governments Regulate Governments.”</span> <em>American Journal of Political Science</em> 60 (3): 559–74. <a href="https://doi.org/10.1111/ajps.12221">https://doi.org/10.1111/ajps.12221</a>.
</div>
<div id="ref-marcillo2019" class="csl-entry" role="doc-biblioentry">
Marcillo, Cristina E., and Leigh-Anne H. Krometis. 2019. <span>“Small Towns, Big Challenges: Does Rurality Influence Safe Drinking Water Act Compliance?”</span> <em>AWWA Water Science</em> 1 (1). <a href="https://doi.org/10.1002/aws2.1120">https://doi.org/10.1002/aws2.1120</a>.
</div>
<div id="ref-switzer2017" class="csl-entry" role="doc-biblioentry">
Switzer, David, and Manuel P. Teodoro. 2017. <span>“Class, Race, Ethnicity, and Justice in Safe Drinking Water Compliance*.”</span> <em>Social Science Quarterly</em> 99 (2): 524–35. <a href="https://doi.org/10.1111/ssqu.12397">https://doi.org/10.1111/ssqu.12397</a>.
</div>
<div id="ref-wallsten2008" class="csl-entry" role="doc-biblioentry">
Wallsten, Scott, and Katrina Kosec. 2008. <span>“The Effects of Ownership and Benchmark Competition: An Empirical Analysis of U.S. Water Systems.”</span> <em>International Journal of Industrial Organization</em> 26 (1): 186–205. <a href="https://doi.org/10.1016/j.ijindorg.2006.11.001">https://doi.org/10.1016/j.ijindorg.2006.11.001</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
    } else {
      disableStylesheet(alternateStylesheets);
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<pre class="markdown" data-shortcodes="false"><code>---
title: "A Federal Use Case of the National Water Service Boundary Layer: Screening communities for drinking water finance for the Justice40 Initiative."
author: 
  - Kyle Onda, Center for Geospatial Solutions
date: "`r format(Sys.time(), '%d %B, %Y')`"
format: 
  html:
    title-block-banner: true
    toc: true
    toc-location: left
    toc-depth: 3
    html-math-method: katex
    css: styles.css
    code-fold: true
    code-summary: "show the code"
    code-overflow: wrap
    code-tools: true
    number-sections: true
    theme: 
      dark: slate
      light: flatly
editor: visual
bibliography: references.bib
---

&lt;!-- # Initialization --&gt;

&lt;!-- We require the following packages: --&gt;

&lt;!-- ```{r} --&gt;

&lt;!-- #| echo: false --&gt;

&lt;!-- #| include: false --&gt;

&lt;!-- library(tidyverse) --&gt;

&lt;!-- library(sf) --&gt;

&lt;!-- library(mapview) --&gt;

&lt;!-- library(qs) --&gt;

&lt;!-- ``` --&gt;

&lt;!-- ## Download SDWIS Violations Data --&gt;

&lt;!-- Here we download all of the SDWIS data, and save to a compressed local file --&gt;

&lt;!-- ```{r} --&gt;

&lt;!-- #| eval: false --&gt;

&lt;!-- download.file(url = "https://echo.epa.gov/files/echodownloads/SDWA_latest_downloads.zip", --&gt;

&lt;!--               destfile = "../data/sdwa.zip") --&gt;

&lt;!-- unzip("../data/sdwa.zip", exdir="../data/sdwa") --&gt;

&lt;!-- x &lt;- readr::read_csv("../data/sdwa/SDWA_VIOLATIONS_ENFORCEMENT.csv") --&gt;

&lt;!-- qsave(x,"../data/viol.qs") --&gt;

&lt;!-- ``` --&gt;

&lt;!-- ## Download TEMM Data --&gt;

&lt;!-- Here we download the service boundaries layer, saving to a local compressed file --&gt;

&lt;!-- ```{r} --&gt;

&lt;!-- #| eval: false --&gt;

&lt;!-- temm &lt;- sf::read_sf("https://www.hydroshare.org/resource/6f3386bb4bc945028391cfabf1ea252e/data/contents/temm_layer_v1.0.0/temm.geojson") --&gt;

&lt;!-- qsave(temm, "../data/temm.qs") --&gt;

&lt;!-- ``` --&gt;

&lt;!-- ## Load compressed data --&gt;

&lt;!-- Here we load the compressed data --&gt;

&lt;!-- ```{r} --&gt;

&lt;!-- v &lt;- qread("../data/viol.qs") --&gt;

&lt;!-- g &lt;- qread("../data/temm.qs") --&gt;

&lt;!-- ``` --&gt;

## Introduction

The purpose of this exercise is to demonstrate the value of the [National Water Service Area Boundary layer](https://www.policyinnovation.org/blog/water-boundaries-data) with a Federal government use case. This use case is to quantify the extent to which adding a drinking water quality-based indicator to the Climate and Environmental Justice Screening Tool would change the universe of "communities" (2010 Census Tract geographies) that are highlighted. This document describes the how to construct a binary indicator that corresponds to some drinking-water related risk, implements the indicator

## Defining a drinking water environmental justice indicator

The most common way to do this is to calculate an indicator variable based on drinking water violations data from the U.S. EPA SDWIS database. Here, I review and go over the pros and cons of the most common approaches in governance and the literature. First, some necessary terminology:

### Terminology

Violation

:   A violation of regulations of the Safe Drinking Water Act

Maximum Contaminant Level (MCL) Violation

:   When a concentration of a contaminant is detected to be above the limit allowed in drinking water standards.

Total Coliform Rule

:   A group of maximum contaminant levels and monitoring requirements for the presence of total coliform, fecal coliform, and *E. coli* bacteria.

Maximum Residual Disinfectant Level (MRDL) Violations

:   When a concentration of a disinfectant residual is detected to be above the limit allowed in drinking water standards.

Treatment Technique (TT) rule Violations

:   When specified treatment techniques required for a system's water source are not applied.

Health-based violations

:   Violations that are directly related to health risks in drinking water. Corresponds to all MCL, MRDL, and TT violations.

Monitoring and reporting (MR) violations

:   Failure to conduct drinking water quality tests or to submit the results of those tests in a timely fashion to USEPA or the primacy agency.

Other Violations

:   A USEPA catch-all category for other violations, which are generally either about conducting sanitary surveys of the system or about reporting their test results to the public or water systems they are interconnected with.

Compliance

:   Being in a state of not violating a relevant regulation

Compliance period

:   A period of time when a water system was in violation of a drinking water regulation

### Review of metrics

There are a few considerations in constructing a binary violation indicator:

1.  What types of violations count? MCL only? Health-based only? All?
2.  What contaminants should count in the case of MCL violations? Those monitored under the Total Coliform Rule? Lead and Copper Rule? Nitrates? All?
3.  How long does a violation need to last to be counted? 0 time? 1 month? 1 year?
4.  Over what time period do they count? The past year? 2 years? 5 years? Forever?

A brief review of the literature follows.

+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------+
| Description of metric                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Pros                                                                                                                                                                                          | Cons                                                                                                                   |
+=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+===============================================================================================================================================================================================+========================================================================================================================+
| EPA "Enforcement Priority" (formerly "Serious Violator"), a threshold composed of points weighted highest towards TCR violations, less so for other health-based violations like Nitrates andl LCR, and least for repeated reporting violations over a rolling 5-year period. [See here](https://www.epa.gov/sites/default/files/documents/drinking_water_erp_2009.pdf). Does not count violations that are returned to compliance or are undergoing a verified enforcement action. | -   Already used by USEPA to prioritize enforcement efforts, legitimating use in CEJST                                                                                                        | -   May be considered stigmatizing by utility community                                                                |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                               |                                                                                                                        |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | -   Weighs violations on certain contaminants more highly based on relative risks to health                                                                                                   | -   Opaque, masks the difference between contaminant exposures and negligent monitoring or reporting                   |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                               |                                                                                                                        |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | -   Includes monitoring violations in a scaled manner, focusing on repeat violations.                                                                                                         | -   Includes non-health based violations that may not be desirable in a "access to safe water" oriented indicator      |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                               |                                                                                                                        |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | -   Cares about the speed of return to compliance, i.e. some measure of the temporal aspect of a health risk exposure                                                                         | -   Not including violations with enforcement actions may underestimate current health risks to the service population |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------+
| All violations, over a multi-year period [@wallsten2008; @konisky2015; @marcillo2019]                                                                                                                                                                                                                                                                                                                                                                                               | -   Simple to calculate                                                                                                                                                                       | -   Including monitoring violations may not be appropriate to a health/exposure-based metric                           |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | -   Including monitoring violations captures governance and capacity problems that can undermine the ability of water systems to respond to the needs of their customers.                     |                                                                                                                        |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------+
| TCR MCL violations only, on an annual basis [@allaire2018]                                                                                                                                                                                                                                                                                                                                                                                                                          | -   There is some [evidence](https://nepis.epa.gov/Exe/ZyPURL.cgi?Dockey=P100529K.TXT) that TCR violations are the most systematically reported. Other violations may give a biased estimate. | -   Does not count the many documented cases of other kinds of violations                                              |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                               |                                                                                                                        |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                               | -   The "bias" evidence is from 2000 and may not be as relevant today                                                  |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------+
| All MCL violations over a multi-year period [@dobbin2021; @switzer2017]                                                                                                                                                                                                                                                                                                                                                                                                             | -   Intuitive appeal for considering all contaminants a potential health risk exposure                                                                                                        | -   MRDLs and treatment failures are also important health risk exposures                                              |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                               |                                                                                                                        |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                               | -   Does not capture institutional risks associated with monitoring/ reporting violations                              |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------+
| All Health-Based Violations over a multi-year period [@dobbin2021; @switzer2017]                                                                                                                                                                                                                                                                                                                                                                                                    | -   Intuitive appeal for considering all health-based violations                                                                                                                              | -   Does not capture institutional risks associated with monitoring/ reporting violations                              |
+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------+

### Proposed metric

Binary indicator, which is if the system experienced more than 1 month in health-based violation in the past two years. Discussion can modify the month and year periods. I believe giving a grace period for 1 month over two years leaves room for true fluke events for utilities that otherwise have good process control. I can also simply create the metric for a few combinations and we can see what seems reasonable.

## Implementing the metric

First, we load required packages

quarto-executable-code-5450563D

```r
#| output: false
library(tidyverse)
library(sf)
library(mapview)
library(vroom)
library(qs)
library(janitor)
library(knitr)

sf_use_s2(FALSE)
```

Below, we describe and implement the workflow in R.

### Collate health-based violations with compliance periods ending March 2020 or later from SDWIS

First, we retrieve the .zip archive of the SDWIS data download from USEPA, and unzip the violations data table.

quarto-executable-code-5450563D

```r
#| eval: false
download.file(url = "https://echo.epa.gov/files/echodownloads/SDWA_latest_downloads.zip", destfile = "../data/sdwa.zip")
unzip("data/sdwa.zip", 
      files = "SDWA_VIOLATIONS_ENFORCEMENT.csv",
      exdir = "data")
```

This archive has several tables, the relevant one being `SDWA_VIOLATIONS_ENFORCEMENT.csv`, which as of this version of the workflow, was last updated on April 13, 2022.

quarto-executable-code-5450563D

```r
#| eval: true
unzip("data/sdwa.zip", list = TRUE)
end_date &lt;- as.Date(unzip("data/sdwa.zip", list = TRUE)$Date[11])
```

We load the violations table and filter to violations that end later than April 13, 2020, two years before the the most current data was released.

quarto-executable-code-5450563D

```r
#| eval: true
start_date &lt;- end_date - 365*2
violators &lt;- vroom("data/SDWA_VIOLATIONS_ENFORCEMENT.csv", # read data
                    col_types = cols(.default = "c")) %&gt;%
  filter(IS_HEALTH_BASED_IND == "Y") %&gt;% # select only health-based violations
  mutate( #format dates as dates
    start = as.Date(COMPL_PER_BEGIN_DATE, 
                                   format = "%m/%d/%Y"),
    end = pmin(as.Date(CALCULATED_RTC_DATE,
                                 format = "%m/%d/%Y"),
                              end_date)) # set end date to most current report date


  
  
```

### Calculate the number of days in health-based violation by each CWS within this period

quarto-executable-code-5450563D

```r
#| eval: true
violators &lt;- violators %&gt;%
  mutate(
    violation_duration = end - start
  ) 
  
```

### Filter to CWS with greater than 30 such days

quarto-executable-code-5450563D

```r
#| eval: true
violators &lt;- violators %&gt;%
  filter(end &gt;= start_date) %&gt;%
  filter(violation_duration &gt;= 30) %&gt;%
  distinct(PWSID)
```

### Filter the TEMM national water service boundary layer to those states with comprehensive, non-county-based Tier 1 boundaries, plus Utah

First we download and compress the TEMM layer for quick access in later parts of the workflow

quarto-executable-code-5450563D

```r
#| eval: false
download.file(url = "https://www.hydroshare.org/django_irods/rest_download/6f3386bb4bc945028391cfabf1ea252e/data/contents/temm_layer_v1.0.0/temm.geojson/?url_download=True&amp;zipped=False&amp;aggregation=False", destfile = "data/temm.geojson")

temm &lt;- sf::read_sf("data/temm.geojson")
qsave(temm, file = "data/temm.qs")

```

Now we load the file, and filter for only the states with comprehensive Tier 1 availability (AZ, CA, CT, KS, NJ, NM, OK, PA, TX, WA) as well as Utah for comparison. We also load in Utah's data for Culinwary Water Service Areas, filtering for Community Water Systems, which was not included in the original TEMM layer but has been created by Utah DWR, to compare performance between TEMM estimation methods and Tier 1 if possible.

quarto-executable-code-5450563D

```r
#| eval: true
temm &lt;- qread("data/temm.qs")
states &lt;- c("AZ",
            "CA",
            "CT",
            "KS",
            "NJ",
            "NM",
            "OK",
            "PA",
            "TX",
            "UT",
            "WA")


utah &lt;- sf::read_sf("https://services.arcgis.com/ZzrwjTRez6FJiOq4/arcgis/rest/services/CulinaryWaterServiceAreas/FeatureServer/0/query?where=1%3D1&amp;objectIds=&amp;time=&amp;geometry=&amp;geometryType=esriGeometryEnvelope&amp;inSR=&amp;spatialRel=esriSpatialRelIntersects&amp;resultType=none&amp;distance=0.0&amp;units=esriSRUnit_Meter&amp;returnGeodetic=false&amp;outFields=*&amp;returnGeometry=true&amp;returnCentroid=false&amp;featureEncoding=esriDefault&amp;multipatchOption=xyFootprint&amp;maxAllowableOffset=&amp;geometryPrecision=&amp;outSR=4326&amp;defaultSR=&amp;datumTransformation=&amp;applyVCSProjection=false&amp;returnIdsOnly=false&amp;returnUniqueIdsOnly=false&amp;returnCountOnly=false&amp;returnExtentOnly=false&amp;returnQueryGeometry=false&amp;returnDistinctValues=false&amp;cacheHint=false&amp;orderByFields=&amp;groupByFieldsForStatistics=&amp;outStatistics=&amp;having=&amp;resultOffset=&amp;resultRecordCount=&amp;returnZ=false&amp;returnM=false&amp;returnExceededLimitFeatures=true&amp;quantizationParameters=&amp;sqlFormat=none&amp;f=pgeojson") %&gt;% filter(SYSTEMTYPE == "C")


boundaries &lt;- temm %&gt;% filter(
  state_code %in% states
) %&gt;% select(-service_area_type_code)
```

### Filter the CEJST Census Tracts to the same states

First we download and unzip the data

quarto-executable-code-5450563D

```r
#| eval: false
download.file(url = "https://static-data-screeningtool.geoplatform.gov/data-pipeline/data/score/shapefile/usa.zip", destfile = "data/j40.zip")
unzip("data/j40.zip", exdir = "data/j40")

```

Then we load it and the data dictionary

quarto-executable-code-5450563D

```r
#| eval: true
j40 &lt;- sf::read_sf("data/j40/usa.shp")
j40_dict &lt;- vroom("data/j40/columns.csv")
```

### Filter to the resulting set of CWS with violations

quarto-executable-code-5450563D

```r
#| eval: true
v &lt;- boundaries %&gt;% 
  filter(pwsid %in% violators$PWSID)
```

### Assign the indicator to CEJST Census Tracts that spatially intersect this set of CWS

First we spatially intersect the set of CWS boundaries with the threshold period of health-based violations to the CEJST version of the 2010 U.S. Census Tracts. We also do Utah separately. Caveats:

-   I am not setting a threshold for how large an overlap between a census tract and a utility needs to be. A census tract may have only a small portion covered by a utility and we are counting it. There are two scenarios:

    -   A relatively large system only serves part of a tract on its periphery

    -   A small system with a tier 1 boundary like a mobile home park or golf course community lies completely within a tract much larger than it

    -   I have not quantified this yet

quarto-executable-code-5450563D

```r
#| eval: true
states2 &lt;- c("Arizona",
            "California",
            "Connecticut",
            "Kansas",
            "New Jersey",
            "New Mexico",
            "Oklahoma",
            "Pennsylvania",
            "Texas",
            "Utah",
            "Washington")


j40 &lt;- j40 %&gt;% filter(
  SF %in% states2
)

v1 &lt;- v %&gt;% filter(state_code == states[1])
j1 &lt;- j40 %&gt;% filter(SF == states2[1])

v_j40 &lt;- st_intersection(v1,j1)

for (i in 2:length(states)){
  v1 &lt;- v %&gt;% filter(state_code == states[i])
  j1 &lt;- j40 %&gt;% filter(SF == states2[i])
  v_j40_1 &lt;- st_intersection(v1,j1)
  v_j40 &lt;- bind_rows(v_j40,v_j40_1)
  print(paste0(i))
}


v_utah &lt;- utah %&gt;% filter(DWSYSNUM %in% v$pwsid)
j_utah &lt;- j40 %&gt;% filter(SF == "Utah")

v_j40_utah &lt;- st_intersection(v_utah,j_utah)

qsave(v_j40,"data/viol_pws_j40.qs")
qsave(v_j40_utah, "data/viol_pws_j40_utah.qs")
```

Then, we need to construct indicator as framed by CEJST, meaning we assign to each Census tract a binary indicator as to whether it intersects a violating water system as well as meeting the socioeconomic threshold set by the CEJST (\&gt;65th percentile for percentage of population living on incomes \&lt;200% of the Federal Poverty line and with 80% or more of adults \&gt;15 not enrolled in higher education). We also only allow for Tier 1 and Tier 2a matches, removing all Tier 2b and Tier 3 matches.

quarto-executable-code-5450563D

```r
#| eval: true
states2 &lt;- c("Arizona",
            "California",
            "Connecticut",
            "Kansas",
            "New Jersey",
            "New Mexico",
            "Oklahoma",
            "Pennsylvania",
            "Texas",
            "Utah",
            "Washington")


j40 &lt;- j40 %&gt;% filter(
  SF %in% states2
)

v_j40_utah &lt;- qread("data/viol_pws_j40_utah.qs") 
v_j40 &lt;- qread("data/viol_pws_j40.qs") %&gt;% filter(tier == "Tier 1" | tier == "Tier 2a")

v_j40 &lt;- v_j40 %&gt;% filter(SF != "Utah")

j40_dw &lt;- j40 %&gt;% 
  mutate(
   DW = case_when(GEOID10 %in% v_j40$GEOID10 ~ "SDWA Violation Present",
                       TRUE ~ "SDWA Violation Not Present"), # DW indicator with Tier 2 Utah 
   DW_ut1 = case_when( ((GEOID10 %in% v_j40$GEOID10 &amp; SF != "Utah") | (GEOID10 %in% v_j40_utah$GEOID10)) ~ "SDWA Violation Present",
                       TRUE ~ "SDWA Violation Not Present") # DW indicator with Tier 1 Utah
  )

j40_dw &lt;- j40_dw %&gt;%
  mutate(
    dw_disadv = (DW == "SDWA Violation Present" &amp; M_EBSI == 1),
    dw_disadv_ut1 = (DW_ut1 == "SDWA Violation Present" &amp; M_EBSI == 1)
  )
    

  
```

### Calculate and compare summary statistics for the original set of CEJST tracts (in the filtered states) and the new set, by state, including:

counts

Tract counts in selected states by Drinking Water indicator and current CEJST disadvantage status

quarto-executable-code-5450563D

```r
#| eval: true
j40_dw &lt;- j40_dw %&gt;%
  mutate(
    CEJST_disadv = case_when(
      SM_C == 1 ~ "CEJST disadvantaged",
      TRUE ~ "Not CEJST disadvantaged"
    ), 
    CEJST_income_educ_threshold = case_when(
      M_EBSI == 1 ~ "CEJST 'low' inc/edu",
      TRUE ~ "CEJST 'high' inc/edu"
    )
  )
  x &lt;-  j40_dw %&gt;% st_drop_geometry() %&gt;% 
  tabyl(DW_ut1,CEJST_disadv) %&gt;% 
  adorn_totals(where = c("row","col")) %&gt;%
  adorn_percentages("col") %&gt;%
  adorn_pct_formatting() %&gt;%
  adorn_ns() 
  
  kable(x)

  
```

-   Tract counts in selected states by Drinking Water indicator and current CEJST disadvantage status by State

    ```{r, results='asis'}
    #| eval: true
    j40_dw &lt;- j40_dw %&gt;%
      mutate(
        CEJST_disadv = case_when(
          SM_C == 1 ~ "CEJST disadvantaged",
          TRUE ~ "Not CEJST disadvantaged"
        ), 
        CEJST_income_educ_threshold = case_when(
          M_EBSI == 1 ~ "CEJST 'low' inc/edu",
          TRUE ~ "CEJST 'high' inc/edu"
        )
      )
    j40_dw %&gt;% st_drop_geometry() %&gt;% 
      tabyl(DW_ut1,CEJST_disadv,SF) %&gt;% 
      adorn_totals(where = c("row","col")) %&gt;%
      adorn_percentages("col") %&gt;%
      adorn_pct_formatting() %&gt;%
      adorn_ns() %&gt;%
      walk2(names(.), ~ print(kable(.x, caption = .y)))
    ```

-   Tract counts in selected states by Drinking Water indicator and current CEJST disadvantage status, by the CEJST non-student low-income socioeconomic indicator

```{r, results='asis'}
#| eval: true
x&lt;-j40_dw %&gt;% st_drop_geometry() %&gt;% 
  tabyl(DW_ut1,CEJST_disadv,CEJST_income_educ_threshold) %&gt;% 
  adorn_totals(where = c("row","col")) %&gt;%
  adorn_percentages("col") %&gt;%
  adorn_pct_formatting() %&gt;%
  adorn_ns() %&gt;%
  walk2(names(.), ~ print(kable(.x, caption = .y)))

```

-   total population (see [map](https://cgs-earth.github.io/epic-wsb-national-case-study/map.html))

quarto-executable-code-5450563D

```r
#| eval: true
pop_by_tract_type &lt;- j40_dw %&gt;% 
  ungroup() %&gt;%
  group_by(CEJST_disadv,dw_disadv_ut1) %&gt;% 
  summarise(population = sum(TPF,na.rm=TRUE)) %&gt;% ungroup()

j40_types &lt;- j40_dw %&gt;%
  mutate(cat1 = case_when(
    dw_disadv_ut1 &amp; CEJST_disadv == "CEJST disadvantaged"  ~ "DW EJ indicator + Current CEJST",
    !dw_disadv_ut1 &amp; CEJST_disadv == "CEJST disadvantaged"  ~ "No DW EJ indicator + Current CEJST",
    !dw_disadv_ut1 &amp; CEJST_disadv == "Not CEJST disadvantaged"  ~ "No DW EJ indicator + Not Current CEJST",
    dw_disadv_ut1 &amp; CEJST_disadv == "Not CEJST disadvantaged"  ~ "DW EJ indicator + Not Current CEJST"
  ),
        cat2 = case_when(
         DW_ut1=="SDWA Violation Present" &amp; CEJST_disadv == "CEJST disadvantaged"  ~ "DW violation + Current CEJST",
    DW_ut1=="SDWA Violation Not Present" &amp; CEJST_disadv == "CEJST disadvantaged"  ~ "No DW violation + Current CEJST",
    DW_ut1=="SDWA Violation Not Present" &amp; CEJST_disadv == "Not CEJST disadvantaged"  ~ "No DW violation + Not Current CEJST",
    DW_ut1=="SDWA Violation Present" &amp; CEJST_disadv == "Not CEJST disadvantaged"  ~ "DW violation + Not Current CEJST"   
        )) %&gt;% ungroup()

j40_types_1 &lt;- j40_types %&gt;% group_by(cat1) %&gt;% summarise(pop=sum(TPF,na.rm=TRUE))
j40_types_2 &lt;- j40_types %&gt;% group_by(cat2) %&gt;% summarise(pop=sum(TPF,na.rm=TRUE))

table &lt;- pop_by_tract_type %&gt;% 
  st_drop_geometry() %&gt;% 
  mutate(pop_millions = population/1000000) %&gt;% 
  select(-population) %&gt;%
  pivot_wider(names_from=dw_disadv_ut1, values_from = pop_millions) %&gt;% 
  rename(`DW Violation + low income`=`TRUE`,
                                                                                                                                 `No DW Violation or not low income`=`FALSE`)
kable(table)
```

Map 1: Census Tracts categorized by drinking water violations and current CEJST status

```{r map1}
mapviewOptions(fgb = TRUE)
m1&lt;-mapview::mapview(j40_types_2, zcol="cat2", layer.name="Tract Category")
mapview::mapshot(m1,url="map1.html")
m1
```

Map 2: Census Tracts categorized by provisional drinking water EJ indicator (drinking water violation + low income) and current CEJST status

```{r map2}
mapviewOptions(fgb = TRUE)
m2&lt;-mapview::mapview(j40_types_1, zcol="cat1", layer.name="Tract Category")
mapview::mapshot(m2,url="map2.html")
m2
```

-   measures of income distribution

```{r inc}
#| eval: false
library(tidycensus)
census_api_key("b25f8b1b7bf10561c9cbc3a20a4d2572677f1f05")
options(tigris_use_cache = TRUE)
tr &lt;- tidycensus::get_acs()
```

-   race/ethnicity population distributions

## Discussion

Will discuss results in detail here.

### Headline 1:

959 "poor" tract/communities across the 11 states were identified to have safe drinking water violations, 67 of which were not previously identified as disadvantaged in the CEJST</code></pre>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>